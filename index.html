<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0f0f0f" />
    <meta
      name="description"
      content="Minimal homepage launcher with bookmarks, Google search, quote of the day, and PWA support."
    />
    <link rel="icon" type="image/x-icon" href="img/favicon.ico" />
    <!-- <link rel="shortcut icon" href="img/apple-touch-icon.png" /> -->
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <!-- Preload Font Awesome to reduce CLS -->
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      as="style"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- <link -->
    <!--   href="https://fonts.googleapis.com/css?family=Quicksand" -->
    <!--   rel="stylesheet" -->
    <!-- /> -->
    <!-- <link -->
    <!--   href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" -->
    <!--   rel="stylesheet" -->
    <!-- /> -->
    <title>NewsLauncher</title>
    <style>
      :root {
        --bg1: #1a1a1a;
        --bg2: #101010;
        --color: #ffffff;
        --card: #000000;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: var(--bg1);
        color: var(--color);
        text-align: center;
        overflow-x: hidden;
      }

      /* Prevent CLS: Reserve space for Font Awesome icons before they load */
      .fa-solid,
      .fa-brands,
      [class^="fa-"],
      [class*=" fa-"] {
        display: inline-block;
        width: 1em;
        height: 1em;
        vertical-align: -0.125em;
      }

      body.theme-day {
        --bg1: #ffffff;
        --bg2: #f0f0f0;
        --color: #111;
        --card: #f9f9f9;
      }
      body.theme-night {
        /* --bg1: #111; */
        /* --bg2: #000; */
        /* --color: #eee; */
        /* --card: #1a1a1a; */
        --bg1: #111111;
        --bg2: #1a1a1a; /* Dark grey instead of black */
        --color: #eeeeee;
        --card: #2a2a2a; /* More distinct from bg2 */
      }
      body.theme-sepia {
        /* --bg1: #f4ecd8; */
        /* --bg2: #eaddc3; */
        /* --color: #5b4636; */
        /* --card: #f5e7c4; */
        --bg1: #f4ecd8;
        --bg2: #e0ceb3; /* Slightly darker for better layering */
        --color: #4a3a2b; /* More contrast than original #5b4636 */
        --card: #e6d6b8; /* Distinct from bg2 and bg1 */
      }
      body.theme-gruvbox {
        /* --bg1: #282828; */
        /* --bg2: #1d2021; */
        /* --color: #ebdbb2; */
        /* --card: #3c3836; */
        --bg1: #282828;
        --bg2: #202020; /* Darker to distinguish from card */
        --color: #ebdbb2;
        --card: #3f3a36; /* More separation from bg2 */
      }
      body.theme-tokyo {
        /* --bg1: #1a1b26; */
        /* --bg2: #16161e; */
        /* --color: #a9b1d6; */
        /* --card: #2a2b3c; */
        --bg1: #1a1b26;
        --bg2: #1f1f2b; /* Slightly lighter */
        --color: #a9b1d6;
        --card: #2f3040; /* More contrast from bg2 */
      }
      body.theme-catpuccin {
        /* --bg1: #1e1e2e; */
        /* --bg2: #181825; */
        /* --color: #f5e0dc; */
        /* --card: #2c2c3a; */
        --bg1: #1e1e2e;
        --bg2: #242436; /* Slight contrast bump */
        --color: #f5e0dc;
        --card: #35354c; /* Clearly distinct from bg2 */
      }

      /* üîµ Nord-inspired cool theme */
      body.theme-nord {
        --bg1: #2e3440;
        --bg2: #3b4252;
        --color: #d8dee9;
        --card: #434c5e;
      }

      /* üåÖ Solarized Light variant */
      body.theme-solarized-light {
        --bg1: #fdf6e3;
        --bg2: #eee8d5;
        --color: #586e75;
        --card: #e0dbc3;
      }

      /* üåå Solarized Dark variant */
      body.theme-solarized-dark {
        --bg1: #002b36;
        --bg2: #073642;
        --color: #93a1a1;
        --card: #0d3441;
      }

      /* üçÉ Forest Night theme */
      body.theme-forest {
        --bg1: #0f1d13;
        --bg2: #1b2e1f;
        --color: #c9dbc5;
        --card: #2d4b31;
      }

      #title {
        margin-left: 2rem;
        margin-right: 0.5rem;
      }

      header {
        padding: 40px 16px 16px;
      }

      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .header-bar h1 {
        font-size: 1.8rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .theme-switcher select {
        background-color: var(--bg2);
        color: var(--color);
        border: 1px solid #888;
        padding: 6px 10px;
        border-radius: 5px;
        font-size: 1rem;
        appearance: none;
      }

      #clock {
        font-family: monospace;
        /* font-family: "Orbitron", monospace; */
        font-size: 2.5rem;
        letter-spacing: 0.1em;
        background-color: var(--bg2);
        color: var(--color);
        padding: 10px 20px;
        border-width: 0.1rem;
        border-style: double;
        border-color: var(--color);
        border-radius: 8px;
        text-align: center;
        width: fit-content;
        box-shadow: 0 0 10px var(--bg2);
        margin: 10px auto;
      }

      form {
        margin: 30px auto;
        max-width: 600px;
        color: inherit;
      }

      input[type="text"] {
        padding: 12px;
        width: 80%;
        max-width: 500px;
        border: var(--color);
        border-color: #777777;
        border-radius: 8px;
        font-size: 1em;
        background: var(--bg2);
        color: var(--color);
      }

      input[type="url"] {
        padding: 12px;
        width: 80%;
        max-width: 500px;
        border: 4px;
        border-color: var(--color);
        border-radius: 8px;
        font-size: 1em;
        background: var(--bg2);
        color: var(--color);
      }

      button {
        padding: 12px;
        width: 80%;
        max-width: 500px;
        border: 4px;
        border-color: var(color);
        border-radius: 8px;
        font-size: 1em;
        background: var(--bg2);
        color: var(--color);
      }

      .bookmark-carousel {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 20px;
        min-height: 280px;
      }

      .carousel-arrow {
        flex-shrink: 0;
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        background: var(--card);
        color: var(--color);
        font-size: 1.5rem;
        cursor: pointer;
        transition:
          background 0.2s,
          transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .carousel-arrow:hover {
        background: var(--bg2);
        transform: scale(1.1);
      }

      .carousel-arrow:disabled {
        opacity: 0.3;
        cursor: default;
        pointer-events: none;
      }

      .bookmark-section {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        scroll-snap-type: x mandatory;
        flex: 1;
        padding: 10px 0;
        scrollbar-width: thin;
        scrollbar-color: var(--card) transparent;
      }

      /* Grid view for Folder contents (3 rows) */
      .bookmark-section.grid-view {
        display: grid;
        grid-template-rows: repeat(3, min-content);
        grid-auto-flow: column;
        align-content: center;
      }

      .bookmark-section::-webkit-scrollbar {
        height: 8px;
      }

      .bookmark-section::-webkit-scrollbar-track {
        background: transparent;
      }

      .bookmark-section::-webkit-scrollbar-thumb {
        background: var(--card);
        border-radius: 4px;
      }

      .bookmark-group {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        min-width: 240px;
        max-width: 280px;
        flex-shrink: 0;
        scroll-snap-align: start;
      }

      .folder-card {
        cursor: pointer;
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }

      .folder-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .folder-header {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.1em;
        font-weight: 500;
        padding: 8px 0;
      }

      .folder-header i {
        font-size: 1rem;
        width: 1em;
        height: 1em;
        color: var(--color);
        opacity: 0.8;
      }

      .back-card {
        cursor: pointer;
        background: var(--bg2);
        border: 2px dashed var(--color);
        opacity: 0.8;
        transition: opacity 0.2s ease;
      }

      .back-card:hover {
        opacity: 1;
      }

      .icon-link {
        scroll-snap-align: start;
      }

      .icon-link a {
        text-decoration: none;
        color: inherit;
        font-size: 1em;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px;
        border-radius: 6px;
        transition: background 0.2s ease;
      }

      .icon-link a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .add-bookmark {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 20px;
      }

      footer {
        font-size: 0.8em;
        padding: 30px 10px 20px;
        color: inherit;
        max-width: 700px;
        margin: auto;
      }

      @media (max-width: 768px) {
        .bookmark-section {
          flex-direction: column;
          gap: 30px;
        }

        .bookmark-group {
          width: 90%;
          margin: auto;
        }

        h1 {
          font-size: 1.8em;
        }
      }

      .quote_display {
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-bar">
        <h1><i id="title" class="fa-solid fa-rocket"></i> Web Launcher</h1>
        <div class="theme-switcher">
          <select
            id="themeSelector"
            onchange="changeTheme(this.value)"
            aria-label="Theme Selector"
          >
            <option value="day">‚òÄÔ∏è</option>
            <option value="night">üåô</option>
            <option value="sepia">üéûÔ∏è</option>
            <option value="gruvbox">üß±</option>
            <option value="tokyo">üèôÔ∏è</option>
            <option value="nord">‚ùÑÔ∏è</option>
            <option value="solarized-light">üåÖ</option>
            <option value="solarized-dark">üåÑ</option>
            <option value="theme-forest">üå≤</option>
          </select>
        </div>
      </div>
      <div id="clock"></div>
      <form action="https://www.google.com/search" method="GET" target="_blank">
        <input
          type="text"
          name="q"
          id="googleSearchInput"
          placeholder="Search Google..."
          aria-label="Google search input"
        />
        <button type="submit" style="display: none" aria-label="Search">
          Search
        </button>
      </form>
    </header>

    <div class="bookmark-carousel">
      <button
        class="carousel-arrow carousel-arrow-left"
        aria-label="Scroll left"
        onclick="scrollCarousel(-1)"
      >
        &#8249;
      </button>
      <main class="bookmark-section">
        <!-- Dynamic content will be rendered here -->
      </main>
      <button
        class="carousel-arrow carousel-arrow-right"
        aria-label="Scroll right"
        onclick="scrollCarousel(1)"
      >
        &#8250;
      </button>
    </div>

    <section
      class="bookmark-group user-bookmarks-container"
      aria-label="Your Bookmarks"
      style="margin: 20px auto; max-width: 600px"
    >
      <h2 style="margin-top: 0">My Bookmarks</h2>
      <div id="user-links"></div>
      <div class="add-bookmark">
        <input id="nameInput" type="text" placeholder="Label (e.g., Reddit)" />
        <input
          id="urlInput"
          type="url"
          placeholder="URL (e.g., https://www.reddit.com)"
        />
        <button type="button" onclick="addBookmark()">Add</button>
      </div>
    </section>

    <footer>
      <div id="quote" class="quote_display">Fetching quote of the day...</div>
    </footer>

    <!-- Hotkey Modal -->
    <div
      id="hotkeyModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000000cc;
        color: white;
        z-index: 1000;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: #222;
          padding: 20px;
          border-radius: 8px;
          max-width: 600px;
          width: 90%;
          max-height: 80vh;
          overflow: auto;
        "
      >
        <h2 style="margin-top: 0">Keyboard Shortcuts</h2>
        <ul id="hotkeyList" style="text-align: left; font-size: 1em"></ul>
        <button
          onclick="hideHotkeyModal()"
          type="button"
          style="
            margin-top: 15px;
            padding: 8px 12px;
            background: #444;
            color: white;
            border: none;
            border-radius: 6px;
          "
        >
          Close
        </button>
      </div>
    </div>

    <script>
      // Bookmark Data Structure
      const bookmarkData = {
        folders: [
          {
            id: "news",
            name: "News",
            icon: "fa-newspaper",
            bookmarks: [
              {
                name: "Business Standard",
                url: "https://www.business-standard.com/",
                icon: "fa-briefcase",
              },
              {
                name: "Livemint",
                url: "https://www.livemint.com/news",
                icon: "fa-newspaper",
              },
              {
                name: "Economic Times",
                url: "https://economictimes.indiatimes.com/",
                icon: "fa-chart-line",
              },
              {
                name: "Moneycontrol",
                url: "https://www.moneycontrol.com/",
                icon: "fa-indian-rupee-sign",
              },
              {
                name: "CNBC-TV18",
                url: "https://www.cnbctv18.com/",
                icon: "fa-tv",
              },
              {
                name: "HT",
                url: "https://www.hindustantimes.com/business",
                icon: "fa-landmark",
              },
              {
                name: "Hindu",
                url: "https://www.thehindubusinessline.com/",
                icon: "fa-scale-balanced",
              },
              {
                name: "Zee",
                url: "https://www.zeebiz.com/",
                icon: "fa-bullhorn",
              },
              {
                name: "ET Now",
                url: "https://www.etnownews.com/",
                icon: "fa-broadcast-tower",
              },
              {
                name: "BW Businessworld",
                url: "https://www.businessworld.in/",
                icon: "fa-network-wired",
              },
              {
                name: "News18",
                url: "https://www.news18.com/business/",
                icon: "fa-rss",
              },
              {
                name: "India Today",
                url: "https://www.indiatoday.in/business",
                icon: "fa-lightbulb",
              },
              {
                name: "Financial Express",
                url: "https://www.financialexpress.com/",
                icon: "fa-receipt",
              },
              {
                name: "Business Today",
                url: "https://www.businesstoday.in/",
                icon: "fa-clipboard-list",
              },
              { name: "FT", url: "https://www.ft.com/", icon: "fa-globe" },
              {
                name: "NYT",
                url: "https://www.nytimes.com/international/",
                icon: "fa-book-open",
              },
              { name: "WSJ", url: "https://www.wsj.com/", icon: "fa-pen-nib" },
              {
                name: "Economist",
                url: "https://www.economist.com/",
                icon: "fa-landmark-dome",
              },
              {
                name: "Bloomberg",
                url: "https://www.bloomberg.com/",
                icon: "fa-building-columns",
              },
              {
                name: "Reuters",
                url: "https://www.reuters.com/",
                icon: "fa-signal",
              },
              {
                name: "Nikkei Asia",
                url: "https://asia.nikkei.com/",
                icon: "fa-earth-asia",
              },
              { name: "Fortune", url: "https://fortune.com/", icon: "fa-star" },
              {
                name: "Forbes",
                url: "https://www.forbes.com/",
                icon: "fa-user-tie",
              },
              {
                name: "MarketWatch",
                url: "https://www.marketwatch.com/",
                icon: "fa-eye",
              },
              {
                name: "Barron's",
                url: "https://www.barrons.com/",
                icon: "fa-scroll",
              },
              {
                name: "BI",
                url: "https://www.businessinsider.com/",
                icon: "fa-user-secret",
              },
              { name: "Quartz", url: "https://qz.com/", icon: "fa-droplet" },
              {
                name: "Axios Markets",
                url: "https://www.axios.com/markets",
                icon: "fa-circle-info",
              },
              {
                name: "Statista News",
                url: "https://www.statista.com/topics/996/markets/",
                icon: "fa-chart-pie",
              },
              {
                name: "Morning Brew",
                url: "https://www.morningbrew.com/",
                icon: "fa-mug-hot",
              },
            ],
          },
          {
            id: "tools",
            name: "Tools",
            icon: "fa-toolbox",
            bookmarks: [
              {
                name: "Gmail1",
                url: "https://mail.google.com/mail/u/0/",
                icon: "fa-envelope",
              },
              {
                name: "Gmail2",
                url: "https://mail.google.com/mail/u/1/",
                icon: "fa-envelope",
              },
              {
                name: "Gmail3",
                url: "https://mail.google.com/mail/u/2/",
                icon: "fa-envelope",
              },
              {
                name: "G Sheets",
                url: "https://docs.google.com/spreadsheets/u/0/",
                icon: "fa-table",
              },
              {
                name: "G News",
                url: "https://news.google.com",
                icon: "fa-newspaper",
              },
              {
                name: "Spotify",
                url: "https://open.spotify.com/",
                icon: "fa-music",
              },
              {
                name: "Moodist",
                url: "https://moodist.app",
                icon: "fa-face-smile",
              },
              {
                name: "ChatGPT",
                url: "https://chat.openai.com/",
                icon: "fa-robot",
              },
              {
                name: "NotebookLM",
                url: "https://notebooklm.google.com/",
                icon: "fa-book",
              },
              {
                name: "Gemini",
                url: "https://gemini.google.com/",
                icon: "fa-gem",
              },
              {
                name: "Perplexity",
                url: "https://www.perplexity.ai/",
                icon: "fa-question-circle",
              },
              {
                name: "Discord",
                url: "https://discord.com/channels/@me",
                icon: "fa-discord",
              },
              {
                name: "InData",
                url: "https://ourworldindata.org/",
                icon: "fa-mug-hot",
              },
              {
                name: "Screener.in",
                url: "https://www.screener.in/",
                icon: "fa-chart-line",
              },
              {
                name: "NSE India",
                url: "https://www.nseindia.com/",
                icon: "fa-indian-rupee-sign",
              },
              {
                name: "Github",
                url: "https://github.com/pradyumnac?tab=repositories",
                icon: "fa-github",
              },
            ],
          },
          {
            id: "content",
            name: "Content",
            icon: "fa-book-open",
            bookmarks: [
              {
                name: "C: VP Forum",
                url: "https://forum.valuepickr.com/",
                icon: "fa-users",
              },
              {
                name: "NW: H Marks",
                url: "https://www.oaktreecapital.com/insights/memo",
                icon: "fa-chalkboard-user",
              },
              {
                name: "C: Asan",
                url: "https://www.facebook.com/groups/147164928687742",
                icon: "fa-users",
              },
              {
                name: "NW: Congruence",
                url: "https://www.congruenceadvisors.com/",
                icon: "fa-chalkboard-user",
              },
              {
                name: "NW: Buggy",
                url: "https://buggyhuman.substack.com/",
                icon: "fa-chalkboard-user",
              },
              {
                name: "X: Buggy",
                url: "https://x.com/SridharanAnand",
                icon: "fa-twitter",
              },
              {
                name: "NW: Sangeet",
                url: "https://platforms.substack.com/",
                icon: "fa-chalkboard-user",
              },
              {
                name: "NW: Surgecap",
                url: "https://surgecapital.substack.com/",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: FinshotsD",
                url: "https://www.finshots.in/archive",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: FinshotsM",
                url: "https://www.finshots.in/markets",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: TD Brief",
                url: "https://thedailybrief.zerodha.com/",
                icon: "fa-envelope-open-text",
              },
              {
                name: "CS: Varsity",
                url: "https://www.zerodha.com/varsity/",
                icon: "fa-school",
              },
              {
                name: "NW: Pattu",
                url: "https://www.freefincal.com/",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: S Niveshak",
                url: "https://www.safalniveshak.com/",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: FS",
                url: "https://fs.blog/",
                icon: "fa-envelope-open-text",
              },
              {
                name: "NW: S Bakshi",
                url: "https://fundooprofessor.wordpress.com/",
                icon: "fa-chalkboard-user",
              },
              {
                name: "B: Z Axioms",
                url: "https://drive.google.com/file/d/1gfCtXEWWvHlVOSo8qQLZL5fj2dY44iCM/view?usp=sharing",
                icon: "fa-chalkboard-user",
              },
              {
                name: "NW: N Sleep",
                url: "https://drive.google.com/file/d/1qYksxZzFhKGPya2ykD3L2RYYVgPoRlF1/view?usp=sharing",
                icon: "fa-chalkboard-user",
              },
              {
                name: "NW: OSS Investor",
                url: "https://opensourceinvestor.substack.com/",
                icon: "fa-envelope-open-text",
              },
            ],
          },
        ],
        stickyBookmarks: [],
        validateNoNestedFolders() {
          for (const folder of this.folders) {
            if (folder.bookmarks) {
              for (const bookmark of folder.bookmarks) {
                if (bookmark.folders || bookmark.bookmarks) {
                  throw new Error(
                    `Invalid data: Nested folder detected in "${folder.name}". 2nd level nesting is not allowed.`
                  );
                }
              }
            }
          }
          return true;
        },
      };

      // State Management
      let appState = {
        currentView: "root",
        activeFolder: null,
        currentHotkeys: {},
      };

      // Validate data on load
      try {
        bookmarkData.validateNoNestedFolders();
      } catch (e) {
        console.error(e.message);
        alert(e.message);
      }

      function updateClock() {
        const now = new Date();
        document.getElementById("clock").textContent = now.toLocaleString();
      }
      updateClock();
      setInterval(updateClock, 1000);

      function escapeHtml(unsafe) {
        return unsafe.replace(/[&<"']/g, function (m) {
          return {
            "&": "&amp;",
            "<": "&lt;",
            '"': "&quot;",
            "'": "&#039;",
          }[m];
        });
      }

      // Bookmark Rendering Functions
      function renderBookmarkItem(bookmark) {
        return `
          <div class="icon-link">
            <a target="_blank" href="${bookmark.url}">
              <i class="fa-solid ${bookmark.icon || "fa-link"}"></i> ${bookmark.name}
            </a>
          </div>
        `;
      }

      function renderFolderCard(folder) {
        return `
          <section class="bookmark-group folder-card" data-folder-id="${folder.id}" aria-label="${folder.name}">
            <div class="folder-header">
              <i class="fa-solid ${folder.icon || "fa-folder"}"></i>
              <span class="folder-name">${folder.name}</span>
            </div>
          </section>
        `;
      }

      function renderBackButton() {
        return `
          <section class="bookmark-group back-card" id="back-button" aria-label="Go Back">
            <div class="folder-header">
              <i class="fa-solid fa-arrow-left"></i>
              <span class="folder-name">Back</span>
            </div>
          </section>
        `;
      }

      function renderRootView() {
        const container = document.querySelector(".bookmark-section");
        container.innerHTML = "";
        container.classList.remove("grid-view");

        // Render sticky bookmarks (if any)
        bookmarkData.stickyBookmarks.forEach((bookmark) => {
          container.insertAdjacentHTML(
            "beforeend",
            renderBookmarkItem(bookmark)
          );
        });

        // Render folders
        bookmarkData.folders.forEach((folder) => {
          container.insertAdjacentHTML("beforeend", renderFolderCard(folder));
        });

        // Add click handlers to folders
        document.querySelectorAll(".folder-card").forEach((card) => {
          card.addEventListener("click", () => {
            const folderId = card.getAttribute("data-folder-id");
            openFolder(folderId);
          });
        });

        // Load custom user bookmarks
        loadUserBookmarks();
        updateArrowState();
      }

      function renderFolderView(folderId) {
        const folder = bookmarkData.folders.find((f) => f.id === folderId);
        if (!folder) return;

        const container = document.querySelector(".bookmark-section");
        container.innerHTML = "";
        container.classList.add("grid-view");

        // Add back button as first item
        container.insertAdjacentHTML("beforeend", renderBackButton());

        // Render folder bookmarks
        folder.bookmarks.forEach((bookmark) => {
          container.insertAdjacentHTML(
            "beforeend",
            renderBookmarkItem(bookmark)
          );
        });

        // Add click handler to back button
        document
          .getElementById("back-button")
          .addEventListener("click", goBack);

        // Load custom user bookmarks for this folder view
        loadUserBookmarks();
        updateArrowState();
      }

      function openFolder(folderId) {
        appState.currentView = "folder";
        appState.activeFolder = folderId;
        renderFolderView(folderId);
        assignHotkeys();
      }

      function updateArrowState() {
        const section = document.querySelector(".bookmark-section");
        const leftArrow = document.querySelector(".carousel-arrow-left");
        const rightArrow = document.querySelector(".carousel-arrow-right");

        if (!section || !leftArrow || !rightArrow) return;

        const hasOverflow = section.scrollWidth > section.clientWidth;

        // If no overflow, disable both
        if (!hasOverflow) {
          leftArrow.disabled = true;
          rightArrow.disabled = true;
          return;
        }

        // Check scroll position
        const scrollLeft = section.scrollLeft;
        const maxScroll = section.scrollWidth - section.clientWidth;

        // Tolerance for float precision
        const tolerance = 1;

        leftArrow.disabled = scrollLeft <= tolerance;
        rightArrow.disabled = scrollLeft >= maxScroll - tolerance;
      }

      function scrollCarousel(direction) {
        const section = document.querySelector(".bookmark-section");
        const scrollAmount = 280; // Approximate card width + gap
        section.scrollBy({
          left: direction * scrollAmount,
          behavior: "smooth",
        });
      }

      // Add scroll listener to update arrows
      document
        .querySelector(".bookmark-section")
        .addEventListener("scroll", () => {
          // Debounce slightly or just run? Running is fine for UI update.
          updateArrowState();
        });

      // Update on resize
      window.addEventListener("resize", updateArrowState);

      function goBack() {
        if (appState.currentView === "folder") {
          appState.currentView = "root";
          appState.activeFolder = null;
          renderRootView();
          assignHotkeys();
        } else {
          hideHotkeyModal();
        }
      }

      function loadBookmarks() {
        renderRootView();
      }

      function loadUserBookmarks() {
        const container = document.getElementById("user-links");
        if (!container) return;

        const bookmarks = JSON.parse(
          localStorage.getItem("customBookmarks") || "[]"
        );
        container.innerHTML = "";
        bookmarks.forEach(({ name, url }) => {
          const link = document.createElement("div");
          link.className = "icon-link";
          link.innerHTML = `<a target="_blank" href="${url}" target="_blank"><i class="fa-solid fa-link"></i> ${name}</a>`;
          container.appendChild(link);
        });
      }

      function addBookmark() {
        const rawName = document.getElementById("nameInput").value.trim();
        const rawUrl = document.getElementById("urlInput").value.trim();
        if (!rawName || !rawUrl) return;
        const name = escapeHtml(rawName);
        const url = escapeHtml(rawUrl);
        const bookmarks = JSON.parse(
          localStorage.getItem("customBookmarks") || "[]"
        );
        bookmarks.push({ name, url });
        localStorage.setItem("customBookmarks", JSON.stringify(bookmarks));
        loadBookmarks();
      }

      function changeTheme(theme) {
        document.body.className = `theme-${theme}`;
        localStorage.setItem("preferredTheme", theme);
      }

      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("preferredTheme") || "sepia";
        var themeSelect = document.getElementById("themeSelector");
        // select dropdown visually as well as by value
        for (var i, j = 0; (i = themeSelect.options[j]); j++) {
          if (i.value == savedTheme) {
            themeSelect.selectedIndex = j;
            break;
          }
        }

        changeTheme(savedTheme);
        loadBookmarks();
      });

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
      }

      /* hotkeys */
      let hotkeyMap2 = {};
      let hotkeyDetails = [];
      let inputBuffer = "";

      function openLinkByKeySeq(seq) {
        const action = hotkeyMap2[seq.toLowerCase()];
        if (action) {
          if (action.type === "folder") {
            openFolder(action.id);
          } else if (action.type === "back") {
            goBack();
          } else {
            window.open(action.href, "_blank");
          }
          inputBuffer = ""; // reset after match
        }
      }

      function generateKeySeq(name, usedCombos) {
        const label = name.trim().toLowerCase().replace(/\s+/g, "");
        for (let i = 0; i < label.length - 1; i++) {
          const pair = label[i] + label[i + 1];
          if (/^[a-z0-9]{2}$/.test(pair) && !usedCombos.has(pair)) {
            usedCombos.add(pair);
            return pair;
          }
        }
        return null;
      }

      function assignHotkeys() {
        hotkeyMap2 = {};
        hotkeyDetails = [];
        const usedCombos = new Set();

        if (appState.currentView === "root") {
          // Assign hotkeys to folders
          bookmarkData.folders.forEach((folder) => {
            const keySeq = generateKeySeq(folder.name, usedCombos);
            if (keySeq) {
              const folderCard = document.querySelector(
                `[data-folder-id="${folder.id}"]`
              );
              if (folderCard) {
                hotkeyMap2[keySeq] = { type: "folder", id: folder.id };
                hotkeyDetails.push({
                  key: keySeq,
                  label: folder.name,
                  url: "Folder",
                });
              }
            }
          });

          // Assign hotkeys to sticky bookmarks
          bookmarkData.stickyBookmarks.forEach((bookmark) => {
            const keySeq = generateKeySeq(bookmark.name, usedCombos);
            if (keySeq) {
              const link = Array.from(
                document.querySelectorAll(".icon-link a")
              ).find((a) => a.textContent.trim() === bookmark.name);
              if (link) {
                hotkeyMap2[keySeq] = { type: "link", href: link.href };
                hotkeyDetails.push({
                  key: keySeq,
                  label: bookmark.name,
                  url: link.href,
                });
              }
            }
          });
        } else if (appState.currentView === "folder") {
          // Assign hotkey to back button
          const backSeq = generateKeySeq("Back", usedCombos);
          if (backSeq) {
            hotkeyMap2[backSeq] = { type: "back" };
            hotkeyDetails.push({
              key: backSeq,
              label: "Go Back",
              url: "Navigation",
            });
          }

          // Assign hotkeys to bookmarks in current folder
          const folder = bookmarkData.folders.find(
            (f) => f.id === appState.activeFolder
          );
          if (folder) {
            folder.bookmarks.forEach((bookmark) => {
              const keySeq = generateKeySeq(bookmark.name, usedCombos);
              if (keySeq) {
                const link = Array.from(
                  document.querySelectorAll(".icon-link a")
                ).find((a) => a.textContent.trim() === bookmark.name);
                if (link) {
                  hotkeyMap2[keySeq] = { type: "link", href: link.href };
                  hotkeyDetails.push({
                    key: keySeq,
                    label: bookmark.name,
                    url: link.href,
                  });
                }
              }
            });
          }
        }

        // Update hotkey list display
        const list = document.getElementById("hotkeyList");
        if (list) {
          list.innerHTML = "";
          hotkeyDetails.forEach(({ key, label, url }) => {
            const li = document.createElement("li");
            li.innerHTML = `<strong>${key}</strong> ‚Üí ${label} <small>(${url})</small>`;
            list.appendChild(li);
          });
        }
      }

      function showHotkeyModal() {
        document.getElementById("hotkeyModal").style.display = "flex";
      }

      function hideHotkeyModal() {
        document.getElementById("hotkeyModal").style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", () => {
        assignHotkeys();
      });

      document.addEventListener("keydown", (e) => {
        const tag = document.activeElement.tagName.toLowerCase();
        if (tag === "input" || tag === "textarea") return;

        if (e.key === "?") {
          showHotkeyModal();
          e.preventDefault();
        } else if (e.key === "Escape") {
          if (appState.currentView === "folder") {
            goBack();
          } else {
            hideHotkeyModal();
          }
          e.preventDefault();
        } else if (e.key === "ArrowLeft") {
          if (appState.currentView === "folder") {
            goBack();
            e.preventDefault();
          }
        } else if (e.key === " ") {
          e.preventDefault();
          const input = document.getElementById("googleSearchInput");
          if (input) input.focus();
        } else if (
          !e.ctrlKey &&
          !e.metaKey &&
          !e.altKey &&
          e.key.length === 1
        ) {
          inputBuffer += e.key.toLowerCase();
          if (inputBuffer.length > 2) {
            inputBuffer = inputBuffer.slice(-2); // keep only last 2 chars
          }
          if (inputBuffer.length === 2) {
            openLinkByKeySeq(inputBuffer);
          }
        }
      });
    </script>

    <script type="module" src="quotes.js" defer></script>
  </body>
</html>
